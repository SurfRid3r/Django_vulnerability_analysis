from django.contrib import admin
from CVE_2020_7471.models import Author,Book
from django.contrib.postgres.aggregates import StringAgg

# Register your models here.


class AuthorAdmin(admin.ModelAdmin):
    def __init__(self, *args, **kwargs):
        super(AuthorAdmin, self).__init__(*args, **kwargs)
        self.list_display += ("books",)

    def books(self, obj):
        return Book.objects.filter(author=obj).aggregate(result=StringAgg("title", delimiter=','))
    
    books.short_description = "Books"


admin.site.register(Author, AuthorAdmin)
